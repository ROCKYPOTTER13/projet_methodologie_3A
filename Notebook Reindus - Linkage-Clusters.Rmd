
---
title: "Notebook réindustrialisation"
author: "Alexandre BOURGEOIS"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
%\VignetteIndexEntry{Vignette Title}
%\VignetteEngine{knitr::rmarkdown}
\usepackage[utf8]{inputenc}
---

**Loading of packages and global parameters**

```{r setup, include=FALSE}
# Display of the code ?
knitr::opts_chunk$set(echo = TRUE) 

# Chargement des packages, chemins d'accès et quelques fonctions utiles
#source("Reindus loading.R")

# chargement des fonctions spécifiques au sujet réindus
#source("Reindus functions.R")
rm(list=ls())
library(microbenchmark)
library(RcppArmadillo)
library(Rcpp)
library(dplyr)
library(ggfortify)
library(dplyr)
library(stringr)
library(tidyverse)
library(readxl)
library(readODS)
library(R6)
library(tidyr)
library(writexl)
library(WriteXLS)
library(xlsx)
library(ggplot2)
library(roxygen2)
library(devtools)
library(forecast)
library(fable)
library(Metrics)
library(xts)
library(data.table)
library(Factoshiny)
library(skimr)
library(tseries)

```

############################################################################################################

Importation des BDD et statistiques descriptives

```{r stat_desc}

BASEres_LinkageBwdFwd_ECOLE<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_LinkageBwdFwd_ECOLE.rds")
BASEres_LinkageBwdFwd_A17<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_LinkageBwdFwd_A17.rds")
BASEres_LinkageBwdFwd_LRWIOD<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_LinkageBwdFwd_LRWIOD.rds")
BASEres_LinkageBwdFwd_WIOD<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_LinkageBwdFwd_WIOD.rds")
BASEres_LinkageBwdFwd_FIGARO<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_LinkageBwdFwd_FIGARO.rds")
Baseres_HEM_A17_FIGARO = readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_HEM_A17_FIGARO.rds")
Baseres_HEM_A17_WIOD = readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_HEM_A17_WIOD(1).rds")
Baseres_HEM_ECOLE = readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/RESULT_HEM_ECOLE.rds")



BDD_bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][,link:="Bwd"]
BDD_fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][,link:="Fwd"]
plot(BDD_bwd$value ~ factor(BDD_bwd$Lig_Indus))
plot(BDD_bwd$value ~ factor(BDD_bwd$Lig_Country))
# plot(BDD_fwd$value ~ factor(BDD_fwd$Lig_Indus))
# plot(BDD_fwd$value ~ factor(BDD_fwd$Lig_Country))
setnames(BDD_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
BDD_bwd_fwd<-rbind(BDD_bwd,BDD_fwd)
BDD_couple_bwd_fwd = merge(BDD_bwd,BDD_fwd,by = c("Lig_Country","Lig_Indus","year"))
colnames(BDD_couple_bwd_fwd) = c("Lig_Country","Lig_Indus","year","value_bwd","link.x","value_fwd","link.y")
BDD_couple_bwd_fwd = BDD_couple_bwd_fwd[,c(-5,-7)]


BDD_statdesc_bwd_fwd_bycountry = BDD_bwd_fwd %>%
  group_by(Lig_Country,year,link) %>%
  summarise(missing_va = sum(is.na(value)),avg = mean(value),ecart_t = sd(value),med = median(value),minim = min(value),q1 = quantile(value,probs = 0.25),q3 = quantile(value,probs = 0.75),maxim = max(value),label_min = Lig_Indus[which.min(value)],label_2nd_min = Lig_Indus[order(value)==2],label_2nd_max = Lig_Indus[order(value,decreasing = T)==2] ,label_max = Lig_Indus[which.max(value)])

BDD_statdesc_bwd_fwd_byIndus = BDD_bwd_fwd %>%
  group_by(Lig_Indus,year,link) %>%
  summarise(missing_va = sum(is.na(value)),avg = mean(value),ecart_t = sd(value),med = median(value),minim = min(value),q1 = quantile(value,probs = 0.25),q3 = quantile(value,probs = 0.75),maxim = max(value),label_min = Lig_Country[which.min(value)],label_2nd_min = Lig_Country[order(value)==2],label_2nd_max = Lig_Country[order(value,decreasing = T)==2] ,label_max = Lig_Country[which.max(value)])

#Les coefficients de backward et forward sont relativement stables en moyenne
#Par conséquent, chercher à travailler de sur des axes d'un autre pays n'apporte pas d'informations  supplémentaires !

BDD_Dom_bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_PartDOM"]][,link:="Bwd"]
BDD_Dom_fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_PartDOM"]][,link:="Fwd"]
# plot(BDD_Dom_bwd$value ~ factor(BDD_Dom_bwd$Lig_Indus))
# plot(BDD_Dom_bwd$value ~ factor(BDD_Dom_bwd$Lig_Country))
# plot(BDD_Dom_fwd$value ~ factor(BDD_Dom_fwd$Lig_Indus))
# plot(BDD_Dom_fwd$value ~ factor(BDD_Dom_fwd$Lig_Country))
setnames(BDD_Dom_bwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
BDD_Dom_bwd_fwd<-rbind(BDD_Dom_bwd,BDD_Dom_fwd)
BDD_couple_Dom_bwd_fwd = cbind(BDD_Dom_bwd,BDD_Dom_fwd,by = c("Lig_Country","Lig_Indus","year"))

BDD_Dom_statdesc_bwd_fwd_bycountry = BDD_Dom_bwd_fwd %>%
  group_by(Lig_Country,year,link) %>%
  summarise(missing_va = sum(is.na(Part_Dom)),avg = mean(Part_Dom),ecart_t = sd(Part_Dom),med = median(Part_Dom),minim = min(Part_Dom),q1 = quantile(Part_Dom,probs = 0.25),q3 = quantile(Part_Dom,probs = 0.75),maxim = max(Part_Dom),label_min = Lig_Indus[which.min(Part_Dom)],label_2nd_min = Lig_Indus[order(Part_Dom)==2],label_2nd_max = Lig_Indus[order(Part_Dom,decreasing = T)==2] ,label_max = Lig_Indus[which.max(Part_Dom)])

BDD_Dom_statdesc_bwd_fwd_byIndus = BDD_Dom_bwd_fwd %>%
  group_by(Lig_Indus,year,link) %>%
  summarise(missing_va = sum(is.na(Part_Dom)),avg = mean(Part_Dom),ecart_t = sd(Part_Dom),med = median(Part_Dom),minim = min(Part_Dom),q1 = quantile(Part_Dom,probs = 0.25),q3 = quantile(Part_Dom,probs = 0.75),maxim = max(Part_Dom),label_min = Lig_Country[which.min(Part_Dom)],label_2nd_min = Lig_Country[order(Part_Dom)==2],label_2nd_max = Lig_Country[order(Part_Dom,decreasing = T)==2] ,label_max = Lig_Country[which.max(Part_Dom)])

####### HEM ###########

BDD_HEM<-Baseres_HEM_A17_FIGARO
plot(BDD_HEM$Indic_HEM ~ factor(BDD_HEM$Lig_Indus))
plot(BDD_HEM$Indic_HEM ~ factor(BDD_HEM$Lig_Country))
# plot(BDD_Dom_fwd$value ~ factor(BDD_Dom_fwd$Lig_Indus))
# plot(BDD_Dom_fwd$value ~ factor(BDD_Dom_fwd$Lig_Country))

BDD_HEM_statdesc_bycountry = BDD_HEM %>%
  group_by(Lig_Country,year) %>%
  summarise(missing_va = sum(is.na(Indic_HEM)),avg = mean(Indic_HEM),ecart_t = sd(Indic_HEM),med = median(Indic_HEM),minim = min(Indic_HEM),q1 = quantile(Indic_HEM,probs = 0.25),q3 = quantile(Indic_HEM,probs = 0.75),maxim = max(Indic_HEM),label_min = Lig_Indus[which.min(Indic_HEM)],label_2nd_min = Lig_Indus[order(Indic_HEM)==2],label_2nd_max = Lig_Indus[order(Indic_HEM,decreasing = T)==2] ,label_max = Lig_Indus[which.max(Indic_HEM)])

BDD_HEM_statdesc_byIndus = BDD_HEM %>%
  group_by(Lig_Indus,year) %>%
  summarise(missing_va = sum(is.na(Indic_HEM)),avg = mean(Indic_HEM),ecart_t = sd(Indic_HEM),med = median(Indic_HEM),minim = min(Indic_HEM),q1 = quantile(Indic_HEM,probs = 0.25),q3 = quantile(Indic_HEM,probs = 0.75),maxim = max(Indic_HEM),label_min = Lig_Country[which.min(Indic_HEM)],label_2nd_min = Lig_Country[order(Indic_HEM)==2],label_2nd_max = Lig_Country[order(Indic_HEM,decreasing = T)==2] ,label_max = Lig_Country[which.max(Indic_HEM)])




```

```{r ts}

ts_pays_couple_bwd_fwd = function(pays){
  bdd_selec = BDD_couple_bwd_fwd %>% filter(Lig_Country == pays)
  bdd_selec = bdd_selec %>% pivot_wider(names_from = Lig_Indus, values_from = c(value_bwd,value_fwd))
  bdd_selec = bdd_selec %>% select(-Lig_Country)
  ts_bdd_selec = ts(bdd_selec %>% select(-year),start = 2000,frequency = 1)
  autoplot(ts_bdd_selec)
  mod = VARselect(ts_bdd_selec,lag.max = 10)
  mod$selection
  varp_best.fit = VAR(ts_bdd_selec, p=1, type = "none")
  
}
pays = "FRA"
  bdd_selec = BDD_couple_bwd_fwd %>% filter(Lig_Country == pays)
  bdd_selec = bdd_selec %>% pivot_wider(names_from = Lig_Indus, values_from = c(value_bwd,value_fwd))
  bdd_selec = bdd_selec %>% select(-Lig_Country)
  ts_bdd_selec = ts(bdd_selec %>% select(-year),start = 2000,frequency = 1)
  typeof(ts_bdd_selec)
  autoplot(ts_bdd_selec)
  library(vars)
  mod = VARselect(ts_bdd_selec,lag.max = 5)
  mod$selection
  varp_best.fit = VAR(ts_bdd_selec, p=1, type = "none")
  roots(varp_best.fit,modulus=TRUE) 
  summary(varp_best.fit)
irf1 = irf(varp_best.fit, impulse = "value_bwd_AZ", response = "value_bwd_C1", n.ahead = 5, boot = TRUE, ci=0,95)
plot(irf1, ylab = "y1", main = "essai")

  
```


PARTIE LINKAGE

############################################################################################################

A faire:
- Branches économiques qui se distinguent au sein du territoire francais (2019,2014,2009,2004)
- Pareil avec les autres pays (2019,2014)
- Parmi les branches qui se distinguent, comparaison entre pays et sur le temps !

```{r}
########################### Croisement Bwd et Fwd sur 2019 (base A17)

# auto_croisementbwdfwd <- function(pays,annee){
#   LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country==pays & year==annee,][,link:="Bwd"]
#   LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Col_Country==pays & year==annee,][,link:="Fwd"]
#   setnames(LinkageBwdFwd_A17_Fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
#   LinkageBwdFwd_A17<-rbind(LinkageBwdFwd_A17_Bwd,LinkageBwdFwd_A17_Fwd)
#   LinkageBwdFwd_A17_tab<-dcast(LinkageBwdFwd_A17,Lig_Indus ~ link,value.var="value")
# 
#   res.km <- kmeans(scale(LinkageBwdFwd_A17_tab[,c(2:3)]), 4, nstart = 10)
#   LinkageBwdFwd_A17_tab$cluster <- res.km$cluster
# 
#   p<-ggplot(LinkageBwdFwd_A17_tab, aes(x=Bwd, y=Fwd, col = factor(cluster))) +
#   geom_point(size = 2, alpha = 0.8, position = "jitter") + # Show dots
#   geom_label(
#     label=LinkageBwdFwd_A17_tab$Lig_Indus,
#     nudge_x = 0.005, nudge_y = 0.005,
#     check_overlap = T
#   )
#   p+geom_hline(data=LinkageBwdFwd_A17_tab,yintercept=mean(LinkageBwdFwd_A17_tab$Fwd))+geom_vline(data=LinkageBwdFwd_A17_tab,xintercept=mean(LinkageBwdFwd_A17_tab$Bwd))
# }
# auto_croisementbwdfwd("FRA","2009")
# auto_croisementbwdfwd("FRA","2004")
# 
# auto_croisementbwdfwd("MEX","2019")
# auto_croisementbwdfwd("MEX","2014")
# auto_croisementbwdfwd("MEX","2009")
# auto_croisementbwdfwd("MEX","2004")
# 
# #Croisement France année 2019
# 
# LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country=="FRA" & year=="2019",][,link:="Bwd"]
# LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Col_Country=="FRA" & year=="2019",][,link:="Fwd"]
# setnames(LinkageBwdFwd_A17_Fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
# LinkageBwdFwd_A17<-rbind(LinkageBwdFwd_A17_Bwd,LinkageBwdFwd_A17_Fwd)
# 
# LinkageBwdFwd_A17_tab<-dcast(LinkageBwdFwd_A17,Lig_Indus ~ link,value.var="value")
# 
# p<-ggplot(LinkageBwdFwd_A17_tab, aes(x=Bwd, y=Fwd)) +
#   geom_point() + # Show dots
#   geom_label(
#     label=LinkageBwdFwd_A17_tab$Lig_Indus,
#     nudge_x = 0.005, nudge_y = 0.005,
#     check_overlap = T
#   )
# p+geom_hline(data=LinkageBwdFwd_A17_tab,yintercept=mean(LinkageBwdFwd_A17_tab$Fwd))+geom_vline(data=LinkageBwdFwd_A17_tab,xintercept=mean(LinkageBwdFwd_A17_tab$Bwd))
# 
# croisement_BwdFwd_pays_annee = function(pays,annee){
#   LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country==pays & year==annee,][,link:="Bwd"]
# LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Col_Country==pays & year==annee,][,link:="Fwd"]
# setnames(LinkageBwdFwd_A17_Fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
# LinkageBwdFwd_A17<-rbind(LinkageBwdFwd_A17_Bwd,LinkageBwdFwd_A17_Fwd)
# 
# LinkageBwdFwd_A17_tab<-dcast(LinkageBwdFwd_A17,Lig_Indus ~ link,value.var="value")
# 
# p<-ggplot(LinkageBwdFwd_A17_tab, aes(x=Bwd, y=Fwd)) +
#   geom_point() + # Show dots
#   geom_label(
#     label=LinkageBwdFwd_A17_tab$Lig_Indus,
#     nudge_x = 0.005, nudge_y = 0.005,
#     check_overlap = T
#   )
# p+geom_hline(data=LinkageBwdFwd_A17_tab,yintercept=mean(LinkageBwdFwd_A17_tab$Fwd))+geom_vline(data=LinkageBwdFwd_A17_tab,xintercept=mean(LinkageBwdFwd_A17_tab$Bwd))
# }
# 
# croisement_BwdFwd_pays_annee("FRA",2019)
# croisement_BwdFwd_pays_annee("FRA",2014)
# croisement_BwdFwd_pays_annee("FRA",2009)
# croisement_BwdFwd_pays_annee("FRA",2004)
# 
# croisement_BwdFwd_pays_annee("MEX",2019)
# croisement_BwdFwd_pays_annee("MEX",2014)
# croisement_BwdFwd_pays_annee("MEX",2009)
# croisement_BwdFwd_pays_annee("MEX",2004)
# 
# # croisement_BwdFwd_pays_annee("USA",2019)
# # croisement_BwdFwd_pays_annee("USA",2014)
# # croisement_BwdFwd_pays_annee("USA",2009)
# # croisement_BwdFwd_pays_annee("USA",2004)
# #
# # croisement_BwdFwd_pays_annee("CHN",2019)
# # croisement_BwdFwd_pays_annee("CHN",2014)
# # croisement_BwdFwd_pays_annee("CHN",2009)
# # croisement_BwdFwd_pays_annee("CHN",2004)
# 

```
```{r essai Adel +}

 LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country=="FRA" & year=="2019",][,link:="Bwd"]
  LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Lig_Country=="FRA" & year=="2019",][,link:="Fwd"]
  #setnames(LinkageBwdFwd_A17_Fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
  LinkageBwdFwd_A17<-rbind(LinkageBwdFwd_A17_Bwd,LinkageBwdFwd_A17_Fwd)
  LinkageBwdFwd_A17_tab<-dcast(LinkageBwdFwd_A17,Lig_Indus ~ link,value.var="value")
  
  LinkageBwdFwd_A17_Bwd_ref<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country=="MEX" & year=="2019",][,link:="Bwd"]
  LinkageBwdFwd_A17_Fwd_ref<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Lig_Country=="MEX" & year=="2019",][,link:="Fwd"]
  #setnames(LinkageBwdFwd_A17_Fwd_ref,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
  LinkageBwdFwd_A17_ref<-rbind(LinkageBwdFwd_A17_Bwd_ref,LinkageBwdFwd_A17_Fwd_ref)
  LinkageBwdFwd_A17_ref_tab<-dcast(LinkageBwdFwd_A17_ref,Lig_Indus ~ link,value.var="value")
  
  
  res.km <- kmeans(scale(LinkageBwdFwd_A17_tab[,c(2:3)]), 4, nstart = 10)
  LinkageBwdFwd_A17_tab$cluster <- res.km$cluster
  
  print(c("Voici les moyennes des fwd et bwd du pays choisi:",median(LinkageBwdFwd_A17_tab$Fwd),median(LinkageBwdFwd_A17_tab$Bwd)))
    print(c("Voici les moyennes des fwd et bwd du pays de référence choisi:",median(LinkageBwdFwd_A17_ref_tab$Fwd),median(LinkageBwdFwd_A17_ref_tab$Bwd)))
  
  p<-ggplot(LinkageBwdFwd_A17_tab, aes(x=Bwd, y=Fwd, col = factor(cluster))) +
  geom_point(size = 2, alpha = 0.8, position = "jitter") + # Show dots
  geom_label(
    label=LinkageBwdFwd_A17_tab$Lig_Indus, 
    nudge_x = 0.005, nudge_y = 0.005, 
    check_overlap = T
  )
  p+geom_hline(data=LinkageBwdFwd_A17_ref_tab,yintercept=mean(LinkageBwdFwd_A17_ref_tab$Fwd))+geom_vline(data=LinkageBwdFwd_A17_tab,xintercept=mean(LinkageBwdFwd_A17_ref_tab$Bwd))
```

Linkage : partie graphs temporels

```{r}

########################### Graphs temporels

# Exploitation des bases : BASEres_LinkageBwdFwd_ECOLE ; BASEres_LinkageBwdFwd_A17 ; BASEres_LinkageBwdFwd_LRWIO 

#### Backward linkage sur base A17
LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country==pays,]
  
LinkageBwdFwd_A17_Bwd_tab<-dcast(LinkageBwdFwd_A17_Bwd,Lig_Indus ~ year ,value.var="value") 
LinkageBwdFwd_A17_Bwd_ttab<-AddRownamesToFirstCol(t(LinkageBwdFwd_A17_Bwd_tab))
colnames(LinkageBwdFwd_A17_Bwd_ttab)<-LinkageBwdFwd_A17_Bwd_ttab[1,]
LinkageBwdFwd_A17_Bwd_ttab<-LinkageBwdFwd_A17_Bwd_ttab[-1,]
LinkageBwdFwd_A17_Bwd_ttab<-setDF(LinkageBwdFwd_A17_Bwd_ttab)
LinkageBwdFwd_A17_Bwd_ttab<- mutate_all(LinkageBwdFwd_A17_Bwd_ttab, function(x) as.numeric(as.character(x)))

evolution_indicateurbwd_pays_A17 = function(pays){
LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country==pays,]
  
LinkageBwdFwd_A17_Bwd_tab<-dcast(LinkageBwdFwd_A17_Bwd,Lig_Indus ~ year ,value.var="value") 
LinkageBwdFwd_A17_Bwd_ttab<-AddRownamesToFirstCol(t(LinkageBwdFwd_A17_Bwd_tab))
colnames(LinkageBwdFwd_A17_Bwd_ttab)<-LinkageBwdFwd_A17_Bwd_ttab[1,]
LinkageBwdFwd_A17_Bwd_ttab<-LinkageBwdFwd_A17_Bwd_ttab[-1,]
LinkageBwdFwd_A17_Bwd_ttab<-setDF(LinkageBwdFwd_A17_Bwd_ttab)
LinkageBwdFwd_A17_Bwd_ttab<- mutate_all(LinkageBwdFwd_A17_Bwd_ttab, function(x) as.numeric(as.character(x)))



List_BR<-colnames(LinkageBwdFwd_A17_Bwd_ttab)[2:18]
matplot(LinkageBwdFwd_A17_Bwd_ttab$Lig_Indus, LinkageBwdFwd_A17_Bwd_ttab[,2:18],type="b",col= hcl.colors(10, "Temps"),pch=c(16,1),xlab="années",ylab="Indic linkage",main=paste("Backward Linkage de ",paste(pays,"au format A17")))
legend(x="bottomleft", legend=List_BR, fill =hcl.colors(10, "Temps"))
}
for (pays in levels(factor(BDD_bwd$Lig_Country))){
  evolution_indicateurbwd_pays_A17(pays)
}

#### Forward linkage sur base A17

evolution_indicateurfwd_pays_A17 = function(pays){
  LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Lig_Country==pays,]
  
  LinkageBwdFwd_A17_Fwd_tab<-dcast(LinkageBwdFwd_A17_Fwd,Lig_Indus ~ year ,value.var="value") 
  LinkageBwdFwd_A17_Fwd_ttab<-AddRownamesToFirstCol(t(LinkageBwdFwd_A17_Fwd_tab))
  colnames(LinkageBwdFwd_A17_Fwd_ttab)<-LinkageBwdFwd_A17_Fwd_ttab[1,]
  LinkageBwdFwd_A17_Fwd_ttab<-LinkageBwdFwd_A17_Fwd_ttab[-1,]
  LinkageBwdFwd_A17_Fwd_ttab<-setDF(LinkageBwdFwd_A17_Fwd_ttab)
  LinkageBwdFwd_A17_Fwd_ttab<- mutate_all(LinkageBwdFwd_A17_Fwd_ttab, function(x) as.numeric(as.character(x)))

  List_BR<-colnames(LinkageBwdFwd_A17_Fwd_ttab)[2:18]
  matplot(LinkageBwdFwd_A17_Fwd_ttab$Lig_Indus, LinkageBwdFwd_A17_Fwd_ttab[,2:18],type="b",col= hcl.colors(10, "Temps"),pch=c(16,1),xlab="années",ylab="Indic linkage",main=paste("Forward Linkage de ",paste(pays,"au format A17")))
  legend(x="bottomleft", legend=List_BR, fill =hcl.colors(10, "Temps"))
}
for (pays in levels(factor(BDD_bwd$Lig_Country))){
  evolution_indicateurfwd_pays_A17(pays)
}

# #### Backward linkage sur base ECOLE et sur toute la période
# 
# 
# LinkageBwdFwd_ECOLE_Bwd<-BASEres_LinkageBwdFwd_ECOLE[["Indic_Bwd_byCountry"]][Lig_Country=="FRA",]
#   
# LinkageBwdFwd_ECOLE_Bwd_tab<-dcast(LinkageBwdFwd_ECOLE_Bwd,Lig_Indus ~ year ,value.var="value") 
# LinkageBwdFwd_ECOLE_Bwd_ttab<-AddRownamesToFirstCol(t(LinkageBwdFwd_ECOLE_Bwd_tab))
# colnames(LinkageBwdFwd_ECOLE_Bwd_ttab)<-LinkageBwdFwd_ECOLE_Bwd_ttab[1,]
# LinkageBwdFwd_ECOLE_Bwd_ttab<-LinkageBwdFwd_ECOLE_Bwd_ttab[-1,]
# LinkageBwdFwd_ECOLE_Bwd_ttab<-setDF(LinkageBwdFwd_ECOLE_Bwd_ttab)
# LinkageBwdFwd_ECOLE_Bwd_ttab<- mutate_all(LinkageBwdFwd_ECOLE_Bwd_ttab, function(x) as.numeric(as.character(x)))
# 
# List_BR<-colnames(LinkageBwdFwd_ECOLE_Bwd_ttab)[2:5]
# matplot(LinkageBwdFwd_ECOLE_Bwd_ttab$Lig_Indus, LinkageBwdFwd_ECOLE_Bwd_ttab[,2:5],type="b",col= hcl.colors(10, "Temps"),pch=c(16,1),xlab="années",ylab="Indic linkage",main="Backward Linkage de la France au format ECOLE")
# legend(x="bottomleft", legend=List_BR, fill =hcl.colors(10, "Temps"))


```


############################################################################################################

PARTIE CLUSTER

############################################################################################################

```{r}
# Chargement des bases
BASE_ECOLE<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/BASE_ECOLE.rds")
BASE_A17<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/BASE_A17.rds")
Interm_LRWIOD<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/BDn_LR_WIOD.rds")
Interm_WIOD<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/BDn_WIOD.rds")
Interm_FIG<-readRDS("C:/Users/Bendounan Adel/Documents/Projet_methodo_3A/BDn_FIG.rds")

LRWIOD_FULL_1990_ALL<-CompoECOLEouA17(BASE_A17,"OptFullOptions",date=1990)
  
VRAI_WIOD_FULL_2007_FULL<-CompoMRIO(Interm_WIOD,"OptFullOptions",date=2007)

A_LRWIOD<-LRWIOD_FULL_1990_ALL[["A"]]

A_WIOD<-VRAI_WIOD_FULL_2007_FULL[["A"]]

A_LRWIOD_DOM<-A_LRWIOD[Lig_Country==Col_Country,]
A_LRWIOD_IMPEXP<-A_LRWIOD[Lig_Country!=Col_Country,]

A_WIOD_DOM<-A_WIOD[Lig_Country==Col_Country,]
A_WIOD_IMPEXP<-A_WIOD[Lig_Country!=Col_Country,]

# Cas particulier
AAA<-AjoutPRBR(A_LRWIOD_IMPEXP)
AAA_tab<-dcast(AAA, PR ~ BR, value.var = "value") # Mise en format tab 
AAA_tab<-GereInfNA(AAA_tab)


plot(density(AAA$value))
boxplot(AAA$value)
print(mean(AAA$value))
print(median(AAA$value))

AAA_SelectSeuil<-AAA[value<mean(AAA$value),value:=0]
AAA_SelectSeuil_tab<-dcast(AAA_SelectSeuil, PR ~ BR, value.var = "value") # Mise en format tab 
AAA_SelectSeuil_tab<-GereInfNA(AAA_SelectSeuil_tab)

# Partie triangulation par Dulmage-Mendhelson
library(Matrix)
interm<-setDF(AAA_SelectSeuil_tab)
Matdf<-GetRownamesFromFirstCol(interm)
Mat<-as.matrix(Matdf,sparse=TRUE)

MatSparse<-as(Mat, "dgTMatrix") 
class(MatSparse)

# https://search.r-project.org/CRAN/refmans/Matrix/html/dgCMatrix-class.html
# https://search.r-project.org/CRAN/refmans/Matrix/html/dmperm.html
#detach("package:Matrix", unload=TRUE)  # Pour réinstaller le package Matrix dernière version (manuellement) si besoin
Mat_dm<-Matrix::dmperm(MatSparse, nAns = 6L, seed = 0L)


```

Changes in version 1.4-1 (2022-03-21 r3446)
Bug Fixes

    diag(x) methods now mostly also keep names from dimnames(x) by default and obey names=* more generally.

New Features

    New virtual class packedMatrix containing packed (dense) symmetric and triangular matrices. Methods for subscripting, including diag(), notably keeping names by default and for t() which are memory efficient, i.e., do not work via unpacking, thanks to Mikael Jagan.

    New dmperm() implementing a Dulmage-Mendelsohn decomposition, thanks to the persistency of Mauricio Vargas (@uc.cl).

    Export more low-level conversion utilities: .n2dgT, .m2ngCn, .m2ngTn.

    Provide some matrix multiplication methods for "RsparseMatrix".


**Lecture des sorties de la décomposition des Dulmage-Mendhelson**

dmperm {Matrix} : For any n×mn (typically) sparse matrix x compute the Dulmage-Mendelsohn row and columns permutations which at first splits the nnn rows and m columns into coarse partitions each; and then a finer one, reordering rows and columns such that the permutated matrix is “as upper triangular” as possible. 

dmperm(x, nAns = 6L, seed = 0L)

Arguments
x 	 : a typically sparse matrix; internally coerced to either "dgCMatrix" or "dtCMatrix".
nAns 	: an integer specifying the length of the resulting list. Must be 2, 4, or 6.
seed 	: an integer code in -1,0,1; determining the (initial) permutation; by default, seed = 0, no (or the identity) permutation; seed = -1 uses the “reverse” permutation k:1; for seed = 1, it is a random permutation (using R's RNG, seed, etc).

Sorties : a named list with (by default) 6 components,
p 	: integer vector with the permutation p, of length nrow(x).
q 	: integer vector with the permutation q, of length ncol(x).
r 	: integer vector of length nb+1, where block k is rows r[k] to r[k+1]-1 in A[p,q].
s 	: integer vector of length nb+1, where block k is cols s[k] to s[k+1]-1 in A[p,q].
rr5 	: integer vector of length 5, defining the coarse row decomposition.
cc5 	: integer vector of length 5, defining the coarse column decomposition.

Tutoriel 1 : simple trouvé en ligne
```{r}
set.seed(17)
(S9 <- rsparsematrix(9, 9, nnz = 10, symmetric=TRUE)) # dsCMatrix
str( dm9 <- dmperm(S9) )
(S9p <- with(dm9, S9[p, q]))
## looks good, but *not* quite upper triangular; these, too:
str( dm9.0 <- dmperm(S9, seed=-1)) # non-random too.
str( dm9_1 <- dmperm(S9, seed= 1)) # a random one
## The last two permutations differ, but have the same effect!
(S9p0 <- with(dm9.0, S9[p, q])) # .. hmm ..
stopifnot(all.equal(S9p0, S9p))# same as as default, but different from the random one
```
> set.seed(17)
> (S9 <- rsparsematrix(9, 9, nnz = 10, symmetric=TRUE)) # dsCMatrix
9 x 9 sparse Matrix of class "dsCMatrix"
                                                  
 [1,] -0.055 .    .    .    .   .    1.6 .    .   
 [2,]  .     .    .    .    .   0.84 .   0.64 .   
 [3,]  .     .    0.63 .    .   .    .   .    1.30
 [4,]  .     .    .    0.16 .   .    .   .    0.37
 [5,]  .     .    .    .    .   .    .   1.20 .   
 [6,]  .     0.84 .    .    .   .    .   .    0.19
 [7,]  1.600 .    .    .    .   .    .   .    .   
 [8,]  .     0.64 .    .    1.2 .    .   .    .   
 [9,]  .     .    1.30 0.37 .   0.19 .   .    .   
> str( dm9 <- dmperm(S9) )
List of 6
 $ p  : int [1:9] 1 7 8 6 9 4 3 2 5
 $ q  : int [1:9] 7 1 5 2 3 4 9 6 8
 $ r  : int [1:8] 0 1 2 3 4 7 8 9
 $ s  : int [1:8] 0 1 2 3 4 7 8 9
 $ rr5: int [1:5] 0 0 9 9 9
 $ cc5: int [1:5] 0 0 0 9 9
> (S9p <- with(dm9, S9[p, q]))
9 x 9 sparse Matrix of class "dgCMatrix"
                                                  
 [1,] 1.6 -0.055 .   .    .    .    .    .    .   
 [2,] .    1.600 .   .    .    .    .    .    .   
 [3,] .    .     1.2 0.64 .    .    .    .    .   
 [4,] .    .     .   0.84 .    .    0.19 .    .   
 [5,] .    .     .   .    1.30 0.37 .    0.19 .   
 [6,] .    .     .   .    .    0.16 0.37 .    .   
 [7,] .    .     .   .    0.63 .    1.30 .    .   
 [8,] .    .     .   .    .    .    .    0.84 0.64
 [9,] .    .     .   .    .    .    .    .    1.20
> ## looks good, but *not* quite upper triangular; these, too:
> str( dm9.0 <- dmperm(S9, seed=-1)) # non-random too.
List of 6
 $ p  : int [1:9] 1 7 8 6 9 4 3 2 5
 $ q  : int [1:9] 7 1 5 2 3 4 9 6 8
 $ r  : int [1:8] 0 1 2 3 4 7 8 9
 $ s  : int [1:8] 0 1 2 3 4 7 8 9
 $ rr5: int [1:5] 0 0 9 9 9
 $ cc5: int [1:5] 0 0 0 9 9
> str( dm9_1 <- dmperm(S9, seed= 1)) # a random one
List of 6
 $ p  : int [1:9] 1 7 8 6 3 9 4 2 5
 $ q  : int [1:9] 7 1 5 2 3 4 9 6 8
 $ r  : int [1:8] 0 1 2 3 4 7 8 9
 $ s  : int [1:8] 0 1 2 3 4 7 8 9
 $ rr5: int [1:5] 0 0 9 9 9
 $ cc5: int [1:5] 0 0 0 9 9
> ## The last two permutations differ, but have the same effect!
> (S9p0 <- with(dm9.0, S9[p, q])) # .. hmm ..
9 x 9 sparse Matrix of class "dgCMatrix"
                                                  
 [1,] 1.6 -0.055 .   .    .    .    .    .    .   
 [2,] .    1.600 .   .    .    .    .    .    .   
 [3,] .    .     1.2 0.64 .    .    .    .    .   
 [4,] .    .     .   0.84 .    .    0.19 .    .   
 [5,] .    .     .   .    1.30 0.37 .    0.19 .   
 [6,] .    .     .   .    .    0.16 0.37 .    .   
 [7,] .    .     .   .    0.63 .    1.30 .    .   
 [8,] .    .     .   .    .    .    .    0.84 0.64
 [9,] .    .     .   .    .    .    .    .    1.20
> stopifnot(all.equal(S9p0, S9p))# same as as default, but different from the random one

Tuto 2 :
```{r}

set.seed(11)
(M <- triu(rsparsematrix(9,11, 1/4)))
dM <- dmperm(M); with(dM, M[p, q])
(Mp <- M[sample.int(nrow(M)), sample.int(ncol(M))])
dMp <- dmperm(Mp); with(dMp, Mp[p, q])

```

Tuto 3 :
```{r}
set.seed(7)
(n7 <- rsparsematrix(5, 12, nnz = 10, rand.x = NULL))
str( dm.7 <- dmperm(n7) )
stopifnot(exprs = {
  lengths(dm.7[1:2]) == dim(n7)
  identical(dm.7,      dmperm(as(n7, "dMatrix")))
  identical(dm.7[1:4], dmperm(n7, nAns=4))
  identical(dm.7[1:2], dmperm(n7, nAns=2))
})
```
{}

```{r essai Loic}


```



```{r Linkage ACP}

#Rem: Faire une ACP avec en individus les branches et en variables les indicateurs Forward et Backward n'est pas malin du tout ! L'idée est de faire une ACP pour une année donnée avec en individus les pays et en variables les branches !

######## 2019 ########
test<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2019",]
test_PCA <- pivot_wider(data = test, names_from = Lig_Indus, values_from = value)
test_PCA <- select(test_PCA, - "year")
data_2019 <- test_PCA %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_2019)

######## 2014 #########

test<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2014",]
test_PCA <- pivot_wider(data = test, names_from = Lig_Indus, values_from = value)
test_PCA <- select(test_PCA, - "year")
data_2014 <- test_PCA %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_2014)

########### 2009 ###########

test<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2009",]
test_PCA <- pivot_wider(data = test, names_from = Lig_Indus, values_from = value)
test_PCA <- select(test_PCA, - "year")
data_2009 <- test_PCA %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_2009)

########### 2004 ############

test<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2004",]
test_PCA <- pivot_wider(data = test, names_from = Lig_Indus, values_from = value)
test_PCA <- select(test_PCA, - "year")
data_2004 <- test_PCA %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_2004)


######## ACP avec Forward et Backward #######

# LinkageBwdFwd_A17_Bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][Lig_Country=="FRA" & year=="2019",][,link:="Bwd"]
# LinkageBwdFwd_A17_Fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][Col_Country=="FRA" & year=="2019",][,link:="Fwd"]
# setnames(LinkageBwdFwd_A17_Fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
# LinkageBwdFwd_A17<-rbind(LinkageBwdFwd_A17_Bwd,LinkageBwdFwd_A17_Fwd)

###### Code Adel propre #####

###### ACP sur l'année 2019 ########

test_bwd = BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2019",][,link:="Bwd"]
test_fwd = BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][year=="2019",][,link:="Fwd"]
#setnames(test_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
LinkageBwdFwd_A17_2019<-rbind(test_bwd,test_fwd)
LinkageBwdFwd_A17_2019 = LinkageBwdFwd_A17_2019 %>%
  mutate(branche_link = paste(Lig_Indus,link,sep = "_"))

test_bwd_fwd_PCA_2019 <- select(LinkageBwdFwd_A17_2019, c(-"year",-"Lig_Indus",-"link"))

test_bwd_fwd_PCA_2019 = dcast(test_bwd_fwd_PCA_2019,Lig_Country ~ branche_link ,value.var="value") 
data_bwd_fwd_2019 <- test_bwd_fwd_PCA_2019 %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_bwd_fwd_2019)

####### ACP sur l'année 2014 #########

test_bwd = BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2014",][,link:="Bwd"]
test_fwd = BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][year=="2014",][,link:="Fwd"]
setnames(test_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
LinkageBwdFwd_A17_2014<-rbind(test_bwd,test_fwd)
LinkageBwdFwd_A17_2014 = LinkageBwdFwd_A17_2014 %>%
  mutate(branche_link = paste(Lig_Indus,link,sep = "_"))

test_bwd_fwd_PCA_2014 <- select(LinkageBwdFwd_A17_2014, c(-"year",-"Lig_Indus",-"link"))

test_bwd_fwd_PCA_2014 = dcast(test_bwd_fwd_PCA_2014,Lig_Country ~ branche_link ,value.var="value") 
data_bwd_fwd_2014 <- test_bwd_fwd_PCA_2014 %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_bwd_fwd_2014)


####### ACP sur l'année 2009 #########

test_bwd = BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2009",][,link:="Bwd"]
test_fwd = BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][year=="2009",][,link:="Fwd"]
setnames(test_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
LinkageBwdFwd_A17_2009<-rbind(test_bwd,test_fwd)
LinkageBwdFwd_A17_2009 = LinkageBwdFwd_A17_2009 %>%
  mutate(branche_link = paste(Lig_Indus,link,sep = "_"))

test_bwd_fwd_PCA_2009 <- select(LinkageBwdFwd_A17_2009, c(-"year",-"Lig_Indus",-"link"))

test_bwd_fwd_PCA_2009 = dcast(test_bwd_fwd_PCA_2009,Lig_Country ~ branche_link ,value.var="value") 
data_bwd_fwd_2009 <- test_bwd_fwd_PCA_2009 %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_bwd_fwd_2009)

####### ACP sur l'année 2004 #########

test_bwd = BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2004",][,link:="Bwd"]
test_fwd = BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][year=="2004",][,link:="Fwd"]
setnames(test_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
LinkageBwdFwd_A17_2004<-rbind(test_bwd,test_fwd)
LinkageBwdFwd_A17_2004 = LinkageBwdFwd_A17_2004 %>%
  mutate(branche_link = paste(Lig_Indus,link,sep = "_"))

test_bwd_fwd_PCA_2004 <- select(LinkageBwdFwd_A17_2004, c(-"year",-"Lig_Indus",-"link"))

test_bwd_fwd_PCA_2004 = dcast(test_bwd_fwd_PCA_2004,Lig_Country ~ branche_link ,value.var="value") 
data_bwd_fwd_2004 <- test_bwd_fwd_PCA_2004 %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

PCAshiny(data_bwd_fwd_2004)

################# AFM (gp formé par année) #################

test_afm_bwd<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year=="2010" | year=="2011" | year=="2012" | year=="2013" | year=="2014" | year=="2015" | year=="2016" | year=="2017" | year=="2018" | year=="2019",][,link:="Bwd"]
test_afm_fwd<-BASEres_LinkageBwdFwd_A17[["Indic_Fwd_byCountry"]][year=="2010" | year=="2011" | year=="2012" | year=="2013" | year=="2014" | year=="2015" | year=="2016" | year=="2017" | year=="2018" | year=="2019",][,link:="Fwd"]
#setnames(test_afm_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
test_afm<-rbind(test_afm_bwd,test_afm_fwd)

# statistiques_desc = test_afm %>%
#   group_by(Lig_Country,year,link) %>%
#   summarise(missing_va = sum(is.na(value)),avg = mean(value),ecart_t = sd(value),med = median(value),min = min(value),q1 = quantile(value,probs = 0.25),q3 = quantile(value,probs = 0.75),max = max(value),label_min = Lig_Indus[min],label_max = Lig_Indus[max])
# 
# statistiques_desc_essa = test_afm %>%
#   group_by(Lig_Country,year,link) %>%
#   filter(value == min(value))#Ajouter les libelles serait une bonne idée !

#missing_va = sum(is.na(value))
#libel_min = paste(Lig_Indus[min(value)],c(Lig_Indus[quantile(value,probs = 0.07)],Lig_Indus[quantile(value,probs = 0.13)]))
test_AFM <- pivot_wider(data = test_afm, names_from = c(Lig_Indus,link,year), values_from = value)
data_AFM <- test_AFM %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

sd_byvar = skim(data_AFM)
# data_AFM_t = t(data_AFM)
# sd_bycountry = skim(data_AFM_t)

MFAshiny(data_AFM)

groupe <- c(rep(17,20))

res.mfa <- MFA (data_AFM, groupe, type = rep("s",length(groupe)), ind.sup = NULL, name.group = NULL, num.group.sup = NULL, graph = TRUE)

fviz_screeplot(res.mfa)

group <- get_mfa_var(res.mfa, "group")
group

fviz_mfa_var(res.mfa, "group")

# Contribution to the first dimension
fviz_contrib(res.mfa, "group", axes = 1)
# Contribution to the second dimension
fviz_contrib(res.mfa, "group", axes = 2)

fviz_mfa_var(res.mfa, "quanti.var", palette = "jco", 
             col.var.sup = "violet", repel = TRUE)

fviz_contrib(res.mfa, choice = "quanti.var", axes = 1, top = 20,
             palette = "jco")


fviz_mfa_var(res.mfa, "quanti.var", col.var = "contrib", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
             col.var.sup = "violet", repel = TRUE,
             geom = c("point", "text"))

fviz_mfa_ind(res.mfa, col.ind = "cos2", 
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
             repel = TRUE)

################# AFM (gp formé par variable) #################

test_afm_bwd<-BASEres_LinkageBwdFwd_ECOLE[["Indic_Bwd_byCountry"]][year=="2010" | year=="2011" | year=="2012" | year=="2013" | year=="2014" ,][,link:="Bwd"]
test_afm_fwd<-BASEres_LinkageBwdFwd_ECOLE[["Indic_Fwd_byCountry"]][year=="2010" | year=="2011" | year=="2012" | year=="2013" | year=="2014" ,][,link:="Fwd"]
setnames(test_afm_fwd,c("Col_Country","Col_Indus"),c("Lig_Country","Lig_Indus"))
test_afm<-rbind(test_afm_bwd,test_afm_fwd)

test_AFM <- pivot_wider(data = test_afm, names_from = c(Lig_Indus,link,year), values_from = value)
data_AFM <- test_AFM %>%
     remove_rownames() %>%
     column_to_rownames(var = 'Lig_Country')

MFAshiny(data_AFM)

#annee = "2018"
# acp_bwd_annee = function(annee){
#   test<-BASEres_LinkageBwdFwd_A17[["Indic_Bwd_byCountry"]][year==annee,]
#   test_PCA <- pivot_wider(data = test, names_from = Lig_Indus, values_from = value)
#   test_PCA <- select(test_PCA, - "year")
#   data_2019 <- test_PCA %>%
#      remove_rownames() %>%
#      column_to_rownames(var = 'Lig_Country')
#   PCAshiny(data_2019)
# }
# acp_bwd_annee("2018")

```



Sortie XLS
```{r}
write.xlsx(MadeInIrlande_A17_tab, "Made-in Irland.xlsx", sheetName = "Made-in", col.names = TRUE, row.names = TRUE)
write.xlsx(MadeInIrlande_A17_ttab, "Made-in Irland.xlsx", sheetName = "Transposee", col.names = TRUE, row.names = TRUE,append=TRUE)
```

